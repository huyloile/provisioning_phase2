#!/bin/sh

read BODY
MSISDN=""
ORDRE=""
VERSION="" 
ORIGINE=""
##echo ${BODY%%[=]*}
x=`expr "$BODY" : '.*MSISDN=\([0-9]*\)'` && MSISDN="$x"
y=`expr "$BODY" : '.*ORDRE=\([0-Z]*\)'` && ORDRE="$y"
z=`expr "$BODY" : '.*VERSION=\([0-9]*\)'` && VERSION="$z"
w=`expr "$BODY" : '.*ORIGINE=\([0-Z]*\)'` && ORIGINE="$w"

function affiche {
    case $ORIGINE in
	*CMO)
	    affiche_cmo;;
	*MOB)
	    affiche_mobi
    esac
}

function affiche_cmo {
   case $VERSION in
       *1)
	   info;;
       *)
	   info_v2
   esac
}

function affiche_mobi {
   case $VERSION in
       *)
	   info_mobi_v2
   esac
}


function info {
    case $MSISDN in
	*030)
            ## 296: PLus d'un dossier....
	    echo "STATUT=0296;DOSNUMID=;MSISDN=$MSISDN;IMSI=;EPR_NUM=;ESC_NUM=;DOS_MONTANT_REC=;DATEDER=;UNT_NUM=;PLAFOND_E=;SOLDE_E=;VALID24=;NB_CPT=;BONUS=";;
	*031)
	   ## 297:Aucun dossier sachem
	    echo "STATUT=0297;DOSNUMID=;MSISDN=$MSISDN;IMSI=;EPR_NUM=;ESC_NUM=;DOS_MONTANT_REC=;DATEDER=;UNT_NUM=;PLAFOND_E=;SOLDE_E=;VALID24=;NB_CPT=;BONUS=";;
	*032)
	   ## 298:Format sachem NOK
	    echo "STATUT=0298;DOSNUMID=;MSISDN=$MSISDN;IMSI=;EPR_NUM=;ESC_NUM=;DOS_MONTANT_REC=;DATEDER=;UNT_NUM=;PLAFOND_E=;SOLDE_E=;VALID24=;NB_CPT=;BONUS=";;
	*033)
	   ## 299: sachem Incident technique
	    echo "STATUT=0299;DOSNUMID=;MSISDN=$MSISDN;IMSI=;EPR_NUM=;ESC_NUM=;DOS_MONTANT_REC=;DATEDER=;UNT_NUM=;PLAFOND_E=;SOLDE_E=;VALID24=;NB_CPT=;BONUS=";;
	*034)
	   ## 299: CVF HS
	    echo "STATUT=0499;DOSNUMID=;MSISDN=$MSISDN;IMSI=;EPR_NUM=;ESC_NUM=;DOS_MONTANT_REC=;DATEDER=;UNT_NUM=;PLAFOND_E=;SOLDE_E=;VALID24=;NB_CPT=;BONUS=";;
	*035)
	    ## Montant authorisé=7EUR <8Eur
	    echo "STATUT=0000;DOSNUMID=123456;MSISDN=$MSISDN;IMSI=208012080120801;EPR_NUM=00;ESC_NUM=1024;DOS_MONTANT_REC=73000;DATEDER=3f8ff668;UNT_NUM=1;PLAFOND_E=80000;SOLDE_E=6000;VALID24=3f8ff668;NB_CPT=10;BONUS=5";;
	*)
	   ## Par défault OK
	    echo "STATUT=0000;DOSNUMID=123456;MSISDN=$MSISDN;IMSI=208012080120801;EPR_NUM=00;ESC_NUM=1024;DOS_MONTANT_REC=5000;DATEDER=3f8ff668;UNT_NUM=1;PLAFOND_E=80000;SOLDE_E=6000;VALID24=3f8ff668;NB_CPT=10;BONUS=5";;
    esac
}

function info_v2 {
    case $MSISDN in
	*030)
            ## 296: PLus d'un dossier....
	    echo "STATUT=0296;DOSNUMID=;MSISDN=$MSISDN;IMSI=$IMSI;";;
	*031)
             ## 297:Aucun dossier sachem....
	    echo "STATUT=0297;DOSNUMID=;MSISDN=$MSISDN;IMSI=$IMSI;";;
	*032)
	   ## 298:Format sachem NOK
	    echo "STATUT=0298;DOSNUMID=;MSISDN=$MSISDN;IMSI=$IMSI;";;
	*033)
	   ## 299: sachem Incident technique
	    echo "STATUT=0299;DOSNUMID=;MSISDN=$MSISDN;IMSI=$IMSI;";;
	*034)
	   ## 299: CVF HS
	    echo "STATUT=0499;DOSNUMID=;MSISDN=$MSISDN;IMSI=$IMSI;";;
	*035)
            ##  Montant authorisé=5EUR <10Eur
	    echo "STATUT=0;DOSNUMID=123456;MSISDN=$MSISDN;IMSI=$IMSI;EPR_NUM=00;ESC_NUM=0;DOS_CUMUL_REC=73000;DATEDER=3f8ff668;UNT_NUM=1;PLAFOND_E=80000;SOLDE_E=6000;VALID24=3f8ff668;NB_CPT=3;BONUS=5;MOBI_OPTION=1;DOS_DATE_DER_REC=3f8ff668;DOS_MONTANT_REC=5";;
	*)
            ## Par default : OK
	    echo "STATUT=0;DOSNUMID=123456;MSISDN=$MSISDN;IMSI=$IMSI;EPR_NUM=00;ESC_NUM=0;DOS_CUMUL_REC=5000;DATEDER=3f8ff668;UNT_NUM=1;PLAFOND_E=80000;SOLDE_E=6000;VALID24=3f8ff668;NB_CPT=3;BONUS=5;MOBI_OPTION=1;DOS_DATE_DER_REC=3f8ff668;;DOS_MONTANT_REC=5";;
    esac
}


function info_mobi_v2 {
    case $MSISDN in
	*030)
            ## 296: PLus d'un dossier....
	    echo "STATUT=0296;DOSNUMID=;MSISDN=$MSISDN;IMSI=$IMSI;";;
	*031)
             ## 297:Aucun dossier sachem....
	    echo "STATUT=0297;DOSNUMID=;MSISDN=$MSISDN;IMSI=$IMSI;";;
	*032)
	   ## 499: CVF HS
	    echo "STATUT=0499;DOSNUMID=;MSISDN=$MSISDN;IMSI=$IMSI;";;
	*033)
            ##  Plafond <10Eur
	    echo "STATUT=0;DOSNUMID=123456;MSISDN=$MSISDN;IMSI=$IMSI;EPR_NUM=00;ESC_NUM=0;DOS_CUMUL_REC=73000;DATEDER=3f8ff668;UNT_NUM=1;PLAFOND_E=8000;SOLDE_E=6000;VALID24=3f8ff668;NB_CPT=3;BONUS=5;MOBI_OPTION=1;DOS_DATE_DER_REC=3f8ff668;DOS_MONTANT_REC=0";;
	*034)
            ##  Montant authorisé=5EUR <10Eur
	    echo "STATUT=0;DOSNUMID=123456;MSISDN=$MSISDN;IMSI=$IMSI;EPR_NUM=00;ESC_NUM=0;DOS_CUMUL_REC=53000;DATEDER=3f8ff668;UNT_NUM=1;PLAFOND_E=60000;SOLDE_E=6000;VALID24=3f8ff668;NB_CPT=3;BONUS=5;MOBI_OPTION=1;DOS_DATE_DER_REC=3f8ff668;DOS_MONTANT_REC=0";;
	*035)
            ##  Montant authorisé<=30EUR si controle plafond
	    echo "STATUT=0;DOSNUMID=123456;MSISDN=$MSISDN;IMSI=$IMSI;EPR_NUM=00;ESC_NUM=0;DOS_CUMUL_REC=20000;DATEDER=3f8ff668;UNT_NUM=1;PLAFOND_E=50000;SOLDE_E=6000;VALID24=3f8ff668;NB_CPT=3;BONUS=5;MOBI_OPTION=1;DOS_DATE_DER_REC=3f8ff668;DOS_MONTANT_REC=0";;
	*036)
            ## Par default : OK
	    echo "STATUT=0;DOSNUMID=123456;MSISDN=$MSISDN;IMSI=$IMSI;EPR_NUM=00;ESC_NUM=0;DOS_CUMUL_REC=5000;DATEDER=3f8ff668;UNT_NUM=1;PLAFOND_E=80000;SOLDE_E=6000;VALID24=3f8ff668;NB_CPT=3;BONUS=5;MOBI_OPTION=1;DOS_DATE_DER_REC=3f8ff668;;DOS_MONTANT_REC=1000";;
	*)
            ## Par default : OK
	    echo "STATUT=0;DOSNUMID=123456;MSISDN=$MSISDN;IMSI=$IMSI;EPR_NUM=00;ESC_NUM=0;DOS_CUMUL_REC=5000;DATEDER=3f8ff668;UNT_NUM=1;PLAFOND_E=80000;SOLDE_E=6000;VALID24=3f8ff668;NB_CPT=3;BONUS=5;MOBI_OPTION=1;DOS_DATE_DER_REC=3f8ff668;;DOS_MONTANT_REC=0";;
    esac
}


cat <<EOF
Content-Type: text/xml

`affiche`
EOF
